@model EduCloud_v42.Models.CourseElement

@{
    ViewData["Title"] = "Element Details";
    EduCloud_v42.Models.User? user = (EduCloud_v42.Models.User?)ViewBag.User;
    IEnumerable<TaskFile> taskFiles = ViewBag.taskFiles;
    IEnumerable<UserTask> userTasks = ViewBag.userTasks;
}

<h1>Element Details</h1>

<div>
    <h4>Course Element</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Name)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Name)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Description)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Description)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Type)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Type)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Course)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Course.Name)
        </dd>
    </dl>
</div>
<div>
    @foreach(CourseFile file in Model.CourseFiles)
    {
        <a href="@file.Path" download="@file.Name">@file.Name</a>
    }
</div>
@if (user != null && 
     user.UserCourses.Any(uc => uc.CourseId == Model.CourseId && uc.Role == CourseRole.Student))
    {
        if(!user.UserTasks.Any(ut => ut.TaskId == Model.ID))
        {
            <div>
                <form asp-controller="CourseElements" asp-action="Submit" method="post" enctype="multipart/form-data">
                    <input name="files" type="file" multiple/>
                    <input name="elementID" type="hidden" value="@Model.ID"/>
                    <input type="submit" value="Submit"/>
                </form>
            </div>
        }
        else
        {
            <div>
                @foreach(var file in taskFiles)
                {
                    <a href="@file.Path" download="@file.Name">@file.Name</a>
                }
                <form asp-controller="CourseElements" asp-action="Unsubmit" method="post">
                    <input name="elementID" type="hidden" value="@Model.ID"/>
                    <input type="submit" value="Unsubmit"/>
                </form>
            </div>
        }
    }
    else if(user != null && 
     user.UserCourses.Any(uc => uc.CourseId == Model.CourseId && uc.Role == CourseRole.Teacher))
    {
        <div>
            @foreach(UserTask task in userTasks)
            {
                <div>
                    <h3>@task.User.FullName</h3>
                    @foreach(TaskFile file in task.TaskFiles)
                    {
                        <a href="@file.Path" download="@file.Name">@file.Name</a>
                    }
                    <form asp-controller="CourseElements" asp-action="Mark">
                        <input name="elementID" type="hidden" value="@Model.ID"/>
                        <input name="userID" type="hidden" value="@task.UserId"/>
                        <input name="mark" value="@task.Mark" placeholder="Mark"/>
                        <input type="submit" value="Return"/>
                    </form>
                </div>
            }
        </div>

    }
<div>
    @if (user != null && user.UserCourses.Any(uc => uc.CourseId == Model.CourseId && uc.Role == CourseRole.Teacher))
    {
        <a asp-action="Edit" asp-route-id="@Model.ID">Edit</a>
    }
    <a asp-controller="Courses" asp-action="Details" asp-route-id="@Model.CourseId">Back to Course</a>
</div>